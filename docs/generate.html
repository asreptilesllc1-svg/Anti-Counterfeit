<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Generate Product QR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="./libs/qrcode.min.js"></script>

<style>
body {
  background: radial-gradient(circle at top, #0f172a, #020617);
  font-family: system-ui;
  color: #e5e7eb;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}
.card {
  background: #020617;
  padding: 32px;
  border-radius: 18px;
  width: 100%;
  max-width: 460px;
  box-shadow: 0 0 40px rgba(34,211,238,.35);
}
h1 { text-align:center; margin-bottom:20px }
input, button {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:none;
}
input {
  background:#020617;
  color:#e5e7eb;
}
button {
  background: linear-gradient(90deg,#06b6d4,#22d3ee);
  color:#020617;
  font-weight:bold;
  cursor:pointer;
}
#qr { margin-top:24px; text-align:center }
</style>
</head>

<body>
<div class="card">
  <h1>Generate Product QR</h1>

  <input id="id" placeholder="Product ID">
  <input id="name" placeholder="Product Name">
  <input id="batch" placeholder="Batch">

  <button onclick="generate()">Generate QR</button>

  <div id="qr"></div>
</div>

<script>
async function generate() {
  if (!window.QRCode) {
    alert("QR library failed to load");
    return;
  }

  const body = {
    id: id.value,
    name: name.value,
    batch: batch.value
  };

  const res = await fetch(
    "https://anti-counterfeit-backend-new.onrender.com/sign",
    {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(body)
    }
  );

  const data = await res.json();
  const url =
    "https://verify.myproductauth.com/verify.html?p=" +
    encodeURIComponent(data.signedToken);

  document.getElementById("qr").innerHTML="";
  const canvas = document.createElement("canvas");
  canvas.width=360; canvas.height=360;
  QRCode.toCanvas(canvas,url);
  document.getElementById("qr").appendChild(canvas);
}
</script>
</body>
</html>
